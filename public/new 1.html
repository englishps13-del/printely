<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lesson Plan</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;700&family=Rubik+Doodle+Shadow&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/20+nK3vD7/24NqfX/X7k/jR6/J5+9P2xL3P7aF6Q+B5/Y2ZlD12Fq2Fv5A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  
  <style>
    :root {
      --paper-color: #ffffff;
      --background-color: #f1f2f6; /* Lighter grey for better contrast */
      --primary-text: #2c3e50;
      --secondary-text: #7f8c8d;
      --header-color: #8e44ad;
      --line-color: #dcdcdc;
      --box-bg: #f9f9f9;
      --box-border: #e0e0e0;
      --title-font: 'Rubik Doodle Shadow', sans-serif;
      --body-font: 'Quicksand', sans-serif;
    }

       /* Base styles with Doodle theme as default */
        :root {
            --paper-color: #ffffff;
            --background-color: #f1f2f6;
            --primary-text: #2c3e50;
            --secondary-text: #7f8c8d;
            --header-color: #8e44ad;
            --line-color: #dcdcdc;
            --box-bg-new: #f9f9f9;
            --new-box-border: #e0e0e0;
        }

        /* Theme-specific variables */
        .theme-minimalist {
            --primary-text: #334e68;
            --secondary-text: #6d8093;
            --header-color: #5585b5;
            --line-color: #e2e8f0;
            --box-bg-new: #f7f9fc;
            --new-box-border: #cdd9e8;
   --title-font: 'Rubik Doodle Shadow', sans-serif;
--body-font: 'Quicksand', sans-serif;
        }

        .theme-vibrant {
            --primary-text: #2c3e50;
            --secondary-text: #7f8c8d;
            --header-color: #e74c3c;
            --line-color: #f39c12;
            --box-bg-new: #fdf3f0;
            --new-box-border: #e74c3c;
            --title-font: 'Quicksand', sans-serif;
            --body-font: 'Quicksand', sans-serif;
        }

        /* 10 New Themes */
        .theme-autumn {
            --primary-text: #5D4037;
            --secondary-text: #8D6E63;
            --header-color: #E65100;
            --line-color: #A5D6A7;
            --box-bg-new: #FFF3E0;
            --new-box-border: #FFAB91;
        }
        .theme-spring {
            --primary-text: #6A1B9A;
            --secondary-text: #9575CD;
            --header-color: #C8E6C9;
            --line-color: #B2EBF2;
            --box-bg-new: #F1F8E9;
            --new-box-border: #B9F6CA;
        }
        .theme-fire {
            --primary-text: #BF360C;
            --secondary-text: #FFAB91;
            --header-color: #D32F2F;
            --line-color: #FFCDD2;
            --box-bg-new: #FFCDD2;
            --new-box-border: #FF5252;
        }
        .theme-ice {
            --primary-text: #283593;
            --secondary-text: #5C6BC0;
            --header-color: #81D4FA;
            --line-color: #B3E5FC;
            --box-bg-new: #E1F5FE;
            --new-box-border: #4FC3F7;
        }
        .theme-grapevine {
            --primary-text: #4A148C;
            --secondary-text: #7B1FA2;
            --header-color: #BA68C8;
            --line-color: #D1C4E9;
            --box-bg-new: #F3E5F5;
            --new-box-border: #E1BEE7;
        }
        .theme-skyline {
            --primary-text: #263238;
            --secondary-text: #546E7A;
            --header-color: #78909C;
            --line-color: #9E9E9E;
            --box-bg-new: #ECEFF1;
            --new-box-border: #B0BEC5;
        }
        .theme-beach {
            --primary-text: #795548;
            --secondary-text: #BCAAA4;
            --header-color: #FFB74D;
            --line-color: #B3E5FC;
            --box-bg-new: #FFFDE7;
            --new-box-border: #FFE0B2;
        }
        .theme-cityscape {
            --primary-text: #455A64;
            --secondary-text: #9E9E9E;
            --header-color: #607D8B;
            --line-color: #CFD8DC;
            --box-bg-new: #F5F5F5;
            --new-box-border: #BDBDBD;
        }
        .theme-lavender {
            --primary-text: #6A1B9A;
            --secondary-text: #7B1FA2;
            --header-color: #D1C4E9;
            --line-color: #E1BEE7;
            --box-bg-new: #F3E5F5;
            --new-box-border: #E1BEE7;
        }
        .theme-mint {
            --primary-text: #004D40;
            --secondary-text: #26A69A;
            --header-color: #4DB6AC;
            --line-color: #B2DFDB;
            --box-bg-new: #E0F2F1;
            --new-box-border: #B9F6CA;
        }


    body {
      font-family: var(--body-font);
      background: var(--background-color);
      margin: 0;
      padding: 40px;
      display: flex;
      justify-content: center;
    }

    .lesson-plan-container {
      width: 8.5in;
      min-height: 11in;
      background: var(--paper-color);
      border: 1px solid var(--line-color);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      padding: 40px;
      display: flex;
      flex-direction: column;
      transform-origin: top center;
      transition: transform 0.2s ease-in-out;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-family: var(--title-font);
      font-size: 3rem;
      color: var(--header-color);
      margin: 0;
      line-height: 1;
    }

.meta-info {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

    .meta-item {
      display: flex;
      align-items: center;
    }

    .meta-item label {
      font-size: 0.55rem;
      text-transform: uppercase;
      font-weight: 500;
      color: var(--primary-text);
      margin-right: 10px;
    }

    .meta-item input {
      flex-grow: 1;
      border: none;
      border-bottom: 2px solid var(--header-color);
      font-family: var(--body-font);
      font-size: 1rem;
      padding: 4px 0;
      background: transparent;
      font-weight: 500;
      color: var(--primary-text);
      outline: none;
    }

    .section {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
      border: 1px solid var(--line-color);
      border-radius: 8px;
      padding: 25px 20px 20px;
      position: relative;
      background: var(--box-bg);
    }

    .section-title {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--paper-color);
      padding: 5px 15px;
      border: 1px solid var(--line-color);
      border-radius: 5px;
      font-size: 0.9rem;
      text-transform: uppercase;
      font-weight: 700;
      color: var(--header-color);
      letter-spacing: 0.5px;
    }

    textarea, select, input {
      width: 100%;
      border: none;
      outline: none;
      font-family: var(--body-font);
      font-size: 0.95rem;
      line-height: 1.6;
      background: transparent;
      color: var(--primary-text);
      padding: 5px;
      min-height: 40px;
    }

    .two-column-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .three-column-layout {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 15px;
    }

    .footer {
      text-align: center;
      font-size: 0.8rem;
      color: var(--secondary-text);
      margin-top: auto;
      padding-top: 15px;
      border-top: 1px dashed var(--line-color);
    }

    .controls {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      align-items: center;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 8px;
      border-radius: 8px;
      backdrop-filter: blur(5px);
    }

    .theme-switcher select, .action-button {
      font-family: 'Quicksand', sans-serif;
      font-size: 0.9rem;
      padding: 8px 12px;
      border: 1px solid var(--line-color);
      border-radius: 5px;
      background-color: var(--paper-color);
      color: var(--primary-text);
      cursor: pointer;
      outline: none;
      transition: all 0.2s ease-in-out;
    }

    .action-button:hover {
      background-color: var(--header-color);
      color: var(--paper-color);
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

   .new-box {
      border: 1px solid var(--new-box-border);
      border-radius: 8px;
      background-color: var(--box-bg-new);
      padding: 20px;
      margin-bottom: 20px;
    }

    .new-box .new-title {
      font-size: 1rem;
      font-weight: 700;
      text-transform: uppercase;
      text-align: center;
      color: var(--header-color);
      margin-bottom: 12px;
      border-bottom: 2px solid var(--header-color);
      padding-bottom: 4px;
    }

    .checkbox-inline {
      display: flex;
      justify-content: center;
      gap: 20px;
      font-size: 0.8rem;
      flex-wrap: nowrap;
    }

    .checkbox-inline label {
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .checkbox-inline input {
      transform: scale(0.9);
    }

    .section-title.small-title {
      font-size: 0.75rem;
      padding: 2px 10px;
      min-width: 150px;
      text-align: center;
    }
    .lesson-details-grid {
      display: grid;
      grid-template-columns: 30% 70%;
      grid-template-rows: auto auto auto;
      gap: 10px 15px;
    }
    .lesson-details-grid select {
      width: 100%;
      padding: 6px;
      border: none;
      border-bottom: 2px solid var(--header-color);
      border-radius: 0;
      background: transparent;
      font-size: 0.9rem;
      outline: none;
    }
	
    .lesson-details-grid .full-width {
      grid-column: 1 / span 2;
    }
    .meta-info {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 15px;
      margin-bottom: 25px;
      align-items: center;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .meta-item label {
      font-size: 0.7rem;
      text-transform: uppercase;
      font-weight: 800;
      color: var(--primary-text);
      white-space: nowrap;
    }

    .meta-item input {
      flex-grow: 1;
      border: none;
      border-bottom: 1px solid var(--header-color);
      font-size: 0.95rem;
      padding: 0px 0;
      background: transparent;
      outline: none;
      font-weight: 500;
      color: var(--primary-text);
    }

    /* Checkbox Colors */
    :root { --checkbox1: #8e44ad; --checkbox2: #2980b9; --checkbox3: #27ae60; --checkbox4: #d35400; }
    .theme-minimalist { --checkbox1: #5585b5; --checkbox2: #334e68; --checkbox3: #6d8093; --checkbox4: #99aabb; }
    .theme-vibrant { --checkbox1: #e74c3c; --checkbox2: #f39c12; --checkbox3: #27ae60; --checkbox4: #2980b9; }
    .theme-autumn { --checkbox1: #E65100; --checkbox2: #FF7043; --checkbox3: #5D4037; --checkbox4: #8D6E63; }
    .theme-spring { --checkbox1: #6A1B9A; --checkbox2: #9575CD; --checkbox3: #43A047; --checkbox4: #81C784; }
    .theme-fire { --checkbox1: #BF360C; --checkbox2: #D32F2F; --checkbox3: #FF5722; --checkbox4: #FFAB91; }
    .theme-ice { --checkbox1: #81D4FA; --checkbox2: #4FC3F7; --checkbox3: #0288D1; --checkbox4: #01579B; }
    .theme-grapevine { --checkbox1: #4A148C; --checkbox2: #7B1FA2; --checkbox3: #BA68C8; --checkbox4: #E1BEE7; }
    .theme-skyline { --checkbox1: #263238; --checkbox2: #455A64; --checkbox3: #607D8B; --checkbox4: #90A4AE; }
    .theme-beach { --checkbox1: #FFB74D; --checkbox2: #4FC3F7; --checkbox3: #26A69A; --checkbox4: #795548; }
    .theme-cityscape { --checkbox1: #455A64; --checkbox2: #607D8B; --checkbox3: #9E9E9E; --checkbox4: #BDBDBD; }
    .theme-lavender { --checkbox1: #6A1B9A; --checkbox2: #8E24AA; --checkbox3: #BA68C8; --checkbox4: #E1BEE7; }
    .theme-mint { --checkbox1: #004D40; --checkbox2: #26A69A; --checkbox3: #4DB6AC; --checkbox4: #B9F6CA; }

    .checkbox-inline label:nth-child(1) input { accent-color: var(--checkbox1); }
    .checkbox-inline label:nth-child(2) input { accent-color: var(--checkbox2); }
    .checkbox-inline label:nth-child(3) input { accent-color: var(--checkbox3); }
    .checkbox-inline label:nth-child(4) input { accent-color: var(--checkbox4); }

    .resizable-textarea {
      resize: vertical;
      overflow: auto;
      min-height: 100px;
    }
	
    .small-textarea {
      min-height: 15px !important;
      height: 15px !important;
      resize: none !important;
      overflow: hidden !important;
      line-height: 1.2;
      font-size: 0.65rem;
      padding: 2px 4px;
    }
    .top-split {
      display: grid;
      grid-template-columns: 44% 54%;
      gap: 10px;
    }

    .lesson-details-grid {
      display: grid;
      grid-template-columns: 20% 75%;
      gap: 10px 15px;
    }

    .lesson-details-grid .full-width {
      grid-column: 1 / -1;
    }

    /* Quill Editor Custom Styles */
    .ql-editor {
      background-color: transparent;
      color: var(--primary-text);
      font-family: var(--body-font);
      font-size: 0.95rem; /* This is the "Normal" size */
      line-height: 1.6;
      min-height: 100px;
    }
    .ql-toolbar.ql-snow, .ql-container.ql-snow {
      border: none; /* Removed internal borders */
    }
    .ql-toolbar.ql-snow {
      padding-bottom: 8px; /* Add some space below toolbar */
    }

    /* Custom Resizable Editor */
    .resizable-editor-wrapper {
        position: relative;
        min-height: 150px;
        height: 150px;
    }
    .resize-handle {
        position: absolute;
        width: 20px;
        height: 20px;
        bottom: 0;
        right: 0;
        cursor: nwse-resize;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--header-color);
        opacity: 0.6;
        transition: opacity 0.2s;
    }
    .resize-handle:hover {
        opacity: 1;
    }
    /* MODIFIED: New resize icon */
    .resize-handle::before {
        content: '\f58d'; /* Font Awesome grip icon */
        font-family: "Font Awesome 6 Free";
        font-weight: 900;
        font-size: 14px;
        transform: rotate(45deg);
    }
    
    @page { 
      size: A4; 
      margin: 0;
    }

    @media print {
      .controls, .ql-toolbar, .resize-handle {
        display: none !important;
      }
      body {
        margin: 0 !important;
        padding: 0 !important;
        background: #fff !important;
      }
      .lesson-plan-container {
        width: 210mm !important;
        height: 297mm !important;
        min-height: 297mm !important;
        position: absolute;
        top: 0;
        left: 0;
        margin: 0 !important;
        padding: 15mm !important;
        box-sizing: border-box !important;
        box-shadow: none !important;
        border: none !important;
        transform: scale(1) !important;
      }
      .section, .new-box {
        page-break-inside: avoid !important;
      }
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }
  </style>
</head>
<body>
  <div class="controls">
    <div class="theme-switcher">
        <label for="theme-selector">Theme:</label>
        <select id="theme-selector">
            <option value="doodle">Doodle</option>
            <option value="minimalist">Minimalist</option>
            <option value="vibrant">Vibrant</option>
            <option value="autumn">Autumn</option>
            <option value="spring">Spring</option>
            <option value="fire">Fire</option>
            <option value="ice">Ice</option>
            <option value="grapevine">Grapevine</option>
            <option value="skyline">Skyline</option>
            <option value="beach">Beach</option>
            <option value="cityscape">Cityscape</option>
            <option value="lavender">Lavender</option>
            <option value="mint">Mint</option>
        </select>
    </div>
    <button class="action-button" onclick="window.print()">
      <i class="fas fa-print"></i> Print
    </button>
    <button class="action-button" id="pdf-button">
      <i class="fas fa-file-pdf"></i> PDF
    </button>
	<button class="action-button" id="undo-button">
      <i class="fas fa-undo"></i> Undo
    </button>
    <button class="action-button" id="redo-button">
      <i class="fas fa-redo"></i> Redo
    </button>
    <button class="action-button" id="save-button">
      <i class="fas fa-save"></i> Save
    </button>
    <button class="action-button" id="load-button">
      <i class="fas fa-upload"></i> Load
    </button>
    <button class="action-button" id="zoom-out-button" title="Zoom Out">
      <i class="fas fa-search-minus"></i>
    </button>
    <span id="zoom-display" style="color: var(--primary-text); font-weight: 600; padding: 0 5px; font-size: 0.9rem; user-select: none;">100%</span>
    <button class="action-button" id="zoom-in-button" title="Zoom In">
      <i class="fas fa-search-plus"></i>
    </button>
  </div>
  
  <div class="lesson-plan-container">
    <div class="header">
        <div class="top-split">
        <div class="section">
          <div class="section-title small-title" >General Information</div>
          <div class="meta-info">
            <div class="meta-item">
              <label for="school">Primary School:</label>
              <input type="text" id="school">
            </div>
            <div class="meta-item">
              <label for="teacher">Teacher:</label>
              <input type="text" id="teacher">
            </div>
            <div class="meta-item">
              <label for="learners">Number of Learners:</label>
              <input type="text" id="learners">
            </div>
          </div>
        </div>

        <div class="section">
            <div class="section-title">Lesson Details</div>
            <div class="lesson-details-grid">
            <select id="levelSelect"><option value="">Select Level</option></select>
            <select id="sequenceSelect"><option value="">Select Sequence</option></select>
            <select id="sectionSelect" class="full-width"><option value="">Select Section</option></select>
            <select id="sessionSelect" class="full-width"><option value="">Select Session</option></select>
            </div>
        </div>
        </div>
    </div>

    <div class="new-box">
      <div class="new-title">Learning Objectives</div>
      <textarea class="small-textarea" placeholder="Write learning objectives here..."></textarea>
    </div>

    <div class="two-column-layout">
      <div class="section">
        <div class="section-title small-title">Target Competencies</div>
        <div class="checkbox-inline">
          <label><input type="checkbox"> Interact</label>
          <label><input type="checkbox"> Interpret</label>
          <label><input type="checkbox"> Produce</label>
        </div>
      </div>

      <div class="section">
        <div class="section-title small-title">Teaching Materials</div>
        <div class="checkbox-inline">
          <label><input type="checkbox"> Textbook</label>
          <label><input type="checkbox"> W.B</label>
        </div>
      </div>
    </div>


    <div class="section">
        <div class="section-title">Warmer</div>
        <div class="three-column-layout">
            <textarea class="small-textarea" placeholder="Procedure"></textarea>
            <textarea class="small-textarea" placeholder="Interaction"></textarea>
            <textarea class="small-textarea" placeholder="Time"></textarea>
        </div>
    </div>

    <div class="section">
      <div class="section-title">Install Resources</div>
      <div class="three-column-layout">
        <div class="resizable-editor-wrapper">
            <div id="procedure-editor"></div>
            <div class="resize-handle"></div>
        </div>
        <textarea class="resizable-textarea" placeholder="Interaction"></textarea>
        <textarea class="resizable-textarea" placeholder="Time"></textarea>
      </div>
    </div>

  
    <div class="section">
        <div class="section-title">Assessment</div>
        <div class="three-column-layout">
            <textarea class="small-textarea" placeholder="Procedure"></textarea>
            <textarea class="small-textarea" placeholder="Interaction"></textarea>
            <textarea class="small-textarea" placeholder="Time"></textarea>
        </div>
    </div>

    <div class="new-box">
      <div class="new-title">Activity / Summary</div>
      <textarea class="small-textarea" placeholder="Write activity or summary here..."></textarea>
    </div>


  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

  <script>
    const themeSelector = document.getElementById('theme-selector');
    const root = document.documentElement;

    themeSelector.addEventListener('change', (e) => {
      root.className = '';
      if (e.target.value !== 'doodle') {
        root.classList.add(`theme-${e.target.value}`);
      }
    });

    const pdfButton = document.getElementById('pdf-button');
    pdfButton.addEventListener('click', () => {
      const element = document.querySelector('.lesson-plan-container');
      const filename = 'lesson-plan-' + new Date().toISOString().slice(0, 10) + '.pdf';
      
      const controls = document.querySelector('.controls');
      controls.style.display = 'none';
      
      const originalBodyPadding = document.body.style.padding;
      document.body.style.padding = '0';
      
      const container = document.querySelector('.lesson-plan-container');
      const originalTransform = container.style.transform;
      container.style.transform = 'scale(1)';

      html2pdf(element, {
        margin: 0,
        filename: filename,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, logging: true, dpi: 192, letterRendering: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      }).then(() => {
        controls.style.display = 'flex';
        document.body.style.padding = originalBodyPadding;
        container.style.transform = originalTransform;
      });
    });

    const curriculumData = {"3PS":{"Sequence 01: Family and Friends":{"Section 01: Family":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and write","SESSION 04: I play roles"],"Section 02: Friends":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and write","SESSION 04: I play roles"]},"Sequence 02: School":{"Section 01: School Objects":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and write","SESSION 04: I play roles"],"Section 02: School Subjects":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and write","SESSION 04: I play roles"]},"Sequence 03: Home":{"Section 01: Describing a House":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and write","SESSION 04: I play roles"],"Section 02: Location Rooms in a House":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and write","SESSION 04: I play roles"]},"Sequence 04: Play Time":{"Section 01: Toys":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and write","SESSION 04: I play roles"],"Section 02: Favourite Toys":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and write","SESSION 04: I play roles"]},"Sequence 05: Pets":{"Section 01: Pets":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and write","SESSION 04: I play roles"],"Section 02: Pets Body Parts":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and write","SESSION 04: I play roles"]},"Sequence 06: Birthday":{"Section 01: Party Invitation":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and write","SESSION 04: I play roles"],"Section 02: Party Celebration":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and write","SESSION 04: I play roles"]}},"4PS":{"Sequence 01: Family and Friends":{"Section 01: Family":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and enjoy","SESSION 04: I read and write","SESSION 05: I play roles"],"Section 02: Friends":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and enjoy","SESSION 04: I read and write","SESSION 05: I play roles"]},"Sequence 02: School":{"Section 01: School Facilities":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and enjoy","SESSION 04: I read and write","SESSION 05: I play roles"],"Section 02: Mapping":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and enjoy","SESSION 04: I read and write","SESSION 05: I play roles"]},"Sequence 03: Fun Time and Games":{"Section 01: Fun Time":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and enjoy","SESSION 04: I read and write","SESSION 05: I play roles"],"Section 02: Games":["SESSION 01: I sing and have fun, I listen and repeat","SESSION 02: I read and discover","SESSION 03: I read and enjoy","SESSION 04: I read and write","SESSION 05: I play roles"]}},"5PS":{"Sequence 01: Jobs, Occupations, and Hobbies":{"Section 01: Jobs and Occupations":["SESSION 01: I get ready.","SESSION 02: I listen and interact","SESSION 03: I listen and discover","SESSION 04: I read and understand","SESSION 05: I read and discover","SESSION 06: I learn and enjoy","SESSION 07: I learn and write","SESSION 08: I write"],"Section 02: Hobbies":["SESSION 01: I listen and interact","SESSION 02: I listen and discover","SESSION 03: I read and understand","SESSION 04: I read and discover","SESSION 05: I learn and enjoy","SESSION 06: I learn to write","SESSION 07: I write","SESSION 08: I check my progress"]},"Sequence 02: Hometown, City, Village Amenities":{"Section 01: Hometown, City, Village Amenities":["SESSION 01: I get ready.","SESSION 02: I listen and interact","SESSION 03: I listen and discover","SESSION 04: I read and understand","SESSION 05: I read and discover","SESSION 06: I learn and enjoy","SESSION 07: I learn and write","SESSION 08: I write"],"Section 02: Directions":["SESSION 01: I listen and interact","SESSION 02: I listen and discover","SESSION 03: I read and understand","SESSION 04: I read and discover","SESSION 05: I learn and enjoy","SESSION 06: I learn to write","SESSION 07: I write","SESSION 08: I check my progress"]},"Sequence 03: Holidays and Travelling":{"Section 01: Holidays":["SESSION 01: I get ready.","SESSION 02: I listen and interact","SESSION 03: I listen and discover","SESSION 04: I read and understand","SESSION 05: I read and discover","SESSION 06: I learn and enjoy","SESSION 07: I learn and write","SESSION 08: I write"],"Section 02: Travelling":["SESSION 01: I listen and interact","SESSION 02: I listen and discover","SESSION 03: I read and understand","SESSION 04: I read and discover","SESSION 05: I learn and enjoy","SESSION 06: I learn to write","SESSION 07: I write","SESSION 08: I check my progress"]}}};

    const levelSelect = document.getElementById("levelSelect");
    const sequenceSelect = document.getElementById("sequenceSelect");
    const sectionSelect = document.getElementById("sectionSelect");
    const sessionSelect = document.getElementById("sessionSelect");
    const specialOption = "REMEDIATION & STANDARDISATION";

    function resetSelect(selectElement, placeholderText) {
      selectElement.innerHTML = `<option value="">${placeholderText}</option>`;
    }

    function initializeLevels() {
      resetSelect(levelSelect, "Select Level");
      Object.keys(curriculumData).forEach(level => {
        const option = new Option(level, level);
        levelSelect.add(option);
      });
    }

    levelSelect.addEventListener("change", () => {
      const selectedLevel = levelSelect.value;
      resetSelect(sequenceSelect, "Select Sequence");
      resetSelect(sectionSelect, "Select Section");
      resetSelect(sessionSelect, "Select Session");
      if (!selectedLevel) return;
      const sequences = Object.keys(curriculumData[selectedLevel]);
      sequences.forEach(seq => sequenceSelect.add(new Option(seq, seq)));
      sequenceSelect.add(new Option(specialOption, specialOption));
    });

    sequenceSelect.addEventListener("change", () => {
      const selectedLevel = levelSelect.value;
      const selectedSeq = sequenceSelect.value;
      resetSelect(sectionSelect, "Select Section");
      resetSelect(sessionSelect, "Select Session");
      if (!selectedSeq) return;
      if (selectedSeq === specialOption) {
        sectionSelect.innerHTML = `<option value="${specialOption}">${specialOption}</option>`;
        sessionSelect.innerHTML = `<option value="${specialOption}">${specialOption}</option>`;
        return;
      }
      const sections = Object.keys(curriculumData[selectedLevel][selectedSeq]);
      sections.forEach(sec => sectionSelect.add(new Option(sec, sec)));
    });

    sectionSelect.addEventListener("change", () => {
      const selectedLevel = levelSelect.value;
      const selectedSeq = sequenceSelect.value;
      const selectedSec = sectionSelect.value;
      resetSelect(sessionSelect, "Select Session");
      if (!selectedSec || selectedSec === specialOption) return;
      const sessions = curriculumData[selectedLevel][selectedSeq][selectedSec];
      sessions.forEach(session => sessionSelect.add(new Option(session, session)));
    });

    initializeLevels();

    // --- Quill Editor, Save/Load, and Undo/Redo ---
    let quill; 
    const planId = "default-plan";
    let undoStack = [];
    let redoStack = [];

    // MODIFIED: Whitelist custom font sizes
    const Size = Quill.import('attributors/style/size');
    Size.whitelist = ['8px', '10px', '12px', '14px', '18px', '24px', '36px'];
    Quill.register(Size, true);

    quill = new Quill('#procedure-editor', {
        modules: { 
            toolbar: [
                // MODIFIED: Replaced header with the new size dropdown
                [{ 'size': ['8px', '10px', '12px', '14px', '18px', '24px', '36px'] }],
                [{ 'font': [] }],
                ['bold', 'italic', 'underline', 'strike'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                [{ 'color': [] }, { 'background': [] }],
                [{ 'align': [] }],
                ['clean']
            ]
        },
        placeholder: 'Procedure',
        theme: 'snow'
    });

    function collectPlanData() {
        const data = {};
        document.querySelectorAll("input, textarea, select").forEach(el => {
            if (el.type === "checkbox") data[el.id || el.name] = el.checked;
            else data[el.id || el.name] = el.value;
        });
        data['procedure-editor'] = quill.root.innerHTML;
        return data;
    }

    function restorePlanData(data) {
        document.querySelectorAll("input, textarea, select").forEach(el => {
            const key = el.id || el.name;
            if (data[key] !== undefined) {
                if (el.type === "checkbox") el.checked = data[key];
                else el.value = data[key];
            }
        });
        if (data['procedure-editor']) quill.root.innerHTML = data['procedure-editor'];
    }

    function pushUndoState() {
        undoStack.push(JSON.stringify(collectPlanData()));
        if (undoStack.length > 50) undoStack.shift();
        redoStack = [];
    }
    
    document.querySelector('.lesson-plan-container').addEventListener("input", pushUndoState);
    quill.on('text-change', (delta, oldDelta, source) => { if (source === 'user') pushUndoState(); });

    document.getElementById("undo-button").addEventListener("click", () => {
        if (undoStack.length > 0) {
            redoStack.push(JSON.stringify(collectPlanData()));
            restorePlanData(JSON.parse(undoStack.pop()));
        }
    });

    document.getElementById("redo-button").addEventListener("click", () => {
        if (redoStack.length > 0) {
            undoStack.push(JSON.stringify(collectPlanData()));
            restorePlanData(JSON.parse(redoStack.pop()));
        }
    });

    document.getElementById("save-button").addEventListener("click", () => {
        localStorage.setItem(`lessonplan-${planId}`, JSON.stringify(collectPlanData()));
        alert("Plan saved!");
    });

    document.getElementById("load-button").addEventListener("click", () => {
        const data = JSON.parse(localStorage.getItem(`lessonplan-${planId}`));
        if (data) {
            restorePlanData(data);
            alert("Plan loaded!");
        } else {
            alert("No saved plan found.");
        }
    });
    
    // --- Zoom Functionality ---
    const zoomInButton = document.getElementById('zoom-in-button');
    const zoomOutButton = document.getElementById('zoom-out-button');
    const zoomDisplay = document.getElementById('zoom-display');
    const lessonPlanContainer = document.querySelector('.lesson-plan-container');

    let currentScale = 1.0;
    const scaleStep = 0.1;

    const applyScale = () => {
        lessonPlanContainer.style.transform = `scale(${currentScale})`;
        const basePadding = 40;
        document.body.style.padding = `${basePadding * currentScale}px`;
        zoomDisplay.textContent = `${Math.round(currentScale * 100)}%`;
    };

    zoomInButton.addEventListener('click', () => {
        if (currentScale < 2.0) {
            currentScale += scaleStep;
            applyScale();
        }
    });

    zoomOutButton.addEventListener('click', () => {
        if (currentScale > 0.6) {
            currentScale -= scaleStep;
            applyScale();
        }
    });

    // --- Custom Resizing Logic ---
    const resizable = document.querySelector('.resizable-editor-wrapper');
    const handle = document.querySelector('.resize-handle');
    
    handle.addEventListener('mousedown', function(e) {
        e.preventDefault();
        
        const startX = e.clientX;
        const startY = e.clientY;
        const startWidth = parseInt(document.defaultView.getComputedStyle(resizable).width, 10);
        const startHeight = parseInt(document.defaultView.getComputedStyle(resizable).height, 10);
        
        function doDrag(e) {
            resizable.style.width = (startWidth + e.clientX - startX) + 'px';
            resizable.style.height = (startHeight + e.clientY - startY) + 'px';
        }
        
        function stopDrag() {
            window.removeEventListener('mousemove', doDrag, false);
            window.removeEventListener('mouseup', stopDrag, false);
        }
        
        window.addEventListener('mousemove', doDrag, false);
        window.addEventListener('mouseup', stopDrag, false);
    });
  </script>
</body>
</html>