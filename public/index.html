<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lesson Planner</title>
  <link rel="icon" type="image/x-icon" href="icon.webp">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700;800&display=swap" rel="stylesheet" />
  
  <link rel="stylesheet" href="assets/css/index.css">
  
  <script>
    tailwind.config = {
      darkMode: 'class' // Enable class-based dark mode
    };
  </script>
</head>
<body class="min-h-screen transition-colors duration-500">
  
  <svg class="shape shape-1" viewBox="0 0 100 100"><rect width="100" height="100" rx="20"/></svg>
  <svg class="shape shape-2" viewBox="0 0 100 100"><circle cx="50" cy="50" r="50" /></svg>
  <svg class="shape shape-3" viewBox="0 0 100 100"><polygon points="50,0 100,100 0,100"/></svg>
  <svg class="shape shape-4" viewBox="0 0 100 100"><rect width="100" height="100" rx="12"/></svg>
  <svg class="shape shape-5" viewBox="0 0 100 100"><rect width="70" height="70" transform="translate(50) rotate(45)"/></svg>

<nav class="sticky top-4 max-w-5xl mx-auto z-50">
    <div class="container">
      <button id="menu-toggle" class="md:hidden" aria-label="Open Menu">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>

      <ul id="nav-links" class="hidden md:flex">
        <li><a href="index.html" class="active">Main page</a></li>
        <li><a href="section2.html">Templates</a></li>
        <li id="signup-nav-link"><a href="section3.html">Sign up</a></li>
        <li><a href="flashcards.html">Flashcards</a></li>
		<li><a href="section4.html">Soon</a></li>

      </ul>

      <div class="flex items-center gap-4">
        <div id="user-info" class="hidden md:flex items-center gap-2 text-gray-700 dark:text-gray-300" style="display: none;">
          </div>
        <div class="theme-switcher">
          <input type="checkbox" id="dm-toggle" aria-label="Toggle Dark Mode" />
          <label for="dm-toggle" class="switch">
            <img src="https://cdn-icons-png.flaticon.com/512/3258/3258157.png" alt="Light Mode Icon" class="icon sun" />
            <img src="https://cdn-icons-png.flaticon.com/512/4445/4445942.png" alt="Dark Mode Icon" class="icon moon" />
            <div class="slider">
              <img src="https://cdn-icons-png.flaticon.com/512/3258/3258157.png" alt="Current Theme Icon" id="slider-icon" />
            </div>
          </label>
        </div>
      </div>
      <div class="underline"></div>
    </div>
  </nav>

  <header class="relative text-center py-20 md:py-28 my-8 overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-500 opacity-90 dark:opacity-80"></div>
    <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.webp')] opacity-10"></div>
    <div id="header-text-container" class="relative z-10 text-white px-4">
        <h2 class="text-4xl md:text-6xl font-extrabold mb-4 tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-white to-purple-200 animate-fade-in-down">
            Welcome to the Lesson Plan Builder
        </h2>
        <p class="text-lg md:text-2xl text-purple-100/90 animate-fade-in-up max-w-3xl mx-auto">
            Customize your lesson plan in a few easy steps
        </p>
    </div>
  </header>

<section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-4 md:p-10 max-w-6xl mx-auto relative z-10">
  <a href="#orientation" class="p-6 rounded-2xl shadow-lg hover:shadow-xl bg-white/70 dark:bg-gray-800/50 backdrop-blur-sm text-black dark:text-white transition-all transform hover:-translate-y-1">
    <h3 class="text-xl font-bold mb-2 text-blue-600 dark:text-purple-300">Features Coming Soon</h3>
    <p>See what new and exciting tools are on the horizon.</p>
  </a>

  <a href="#guidelines" class="p-6 rounded-2xl shadow-lg hover:shadow-xl bg-white/70 dark:bg-gray-800/50 backdrop-blur-sm text-black dark:text-white transition-all transform hover:-translate-y-1">
    <h3 class="text-xl font-bold mb-2 text-blue-600 dark:text-purple-300">Feature Showcase</h3>
    <p>Explore the powerful features of our planner.</p>
  </a>

  <a href="#syllabus" class="p-6 rounded-2xl shadow-lg hover:shadow-xl bg-white/70 dark:bg-gray-800/50 backdrop-blur-sm text-black dark:text-white transition-all transform hover:-translate-y-1">
    <h3 class="text-xl font-bold mb-2 text-blue-600 dark:text-purple-300">Year 3, 4, 5 PS Syllabus</h3>
    <p>Detailed syllabus for Primary School Years 3, 4, and 5.</p>
  </a>

  <a href="#topics" class="p-6 rounded-2xl shadow-lg hover:shadow-xl bg-white/70 dark:bg-gray-800/50 backdrop-blur-sm text-black dark:text-white transition-all transform hover:-translate-y-1">
    <h3 class="text-xl font-bold mb-2 text-blue-600 dark:text-purple-300">Download Didactic Guides</h3>
    <p>Get the official didactic guides for each level.</p>
  </a>

  <a href="#planning" class="p-6 rounded-2xl shadow-lg hover:shadow-xl bg-white/70 dark:bg-gray-800/50 backdrop-blur-sm text-black dark:text-white transition-all transform hover:-translate-y-1 col-span-1 md:col-span-2 lg:col-span-1">
    <h3 class="text-xl font-bold mb-2 text-blue-600 dark:text-purple-300">Feedback</h3>
    <p>Leave your comments and suggestions.</p>
  </a>
</section>

<main class="max-w-5xl mx-auto px-4 md:px-6 space-y-32 pb-20 relative z-10">

  <section id="orientation">
    <h2 class="text-3xl font-bold mb-6 text-purple-600 dark:text-purple-300 text-center">Exciting Features Coming Soon!</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
        <div class="bg-white/50 dark:bg-gray-800/40 p-6 rounded-2xl shadow-md backdrop-blur-sm">
            <h3 class="text-xl font-bold mb-2 text-purple-700 dark:text-purple-300">More Themes</h3>
            <p class="leading-relaxed">A wider variety of aesthetically pleasing and customizable themes to perfectly match your unique personal or school branding.</p>
        </div>
        <div class="bg-white/50 dark:bg-gray-800/40 p-6 rounded-2xl shadow-md backdrop-blur-sm">
            <h3 class="text-xl font-bold mb-2 text-purple-700 dark:text-purple-300">All Subjects, All Levels</h3>
            <p class="leading-relaxed">Expanding beyond English and Primary School to provide comprehensive support for all subjects and educational stages.</p>
        </div>
        <div class="bg-white/50 dark:bg-gray-800/40 p-6 rounded-2xl shadow-md backdrop-blur-sm">
            <h3 class="text-xl font-bold mb-2 text-purple-700 dark:text-purple-300">Teacher Collaboration Hub</h3>
            <p class="leading-relaxed">An integrated chat platform for educators to connect, share valuable ideas, and collaborate on lesson plans in real-time.</p>
        </div>
    </div>
  </section>

  <section id="guidelines">
    <h2 class="text-3xl font-bold mb-6 text-purple-600 dark:text-purple-300 text-center">Feature Showcase</h2>
    
    <div class="slideshow-container">
        <div class="slides-wrapper">
            <div class="slide"><img src="11.webp" alt="Instantly Ready Templates"></div>
            <div class="slide"><img src="22.webp" alt="Fully Printable Plans"></div>
            <div class="slide"><img src="33.webp" alt="Multi-Theme Options"></div>
            <div class="slide"><img src="44.webp" alt="Easy Customization"></div>
            <div class="slide"><img src="55.webp" alt="Ready to Print and Download"></div>
        </div>
        
        <button class="slide-btn prev" aria-label="Previous Slide">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/></svg>
        </button>
        <button class="slide-btn next" aria-label="Next Slide">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>
        </button>

        <div class="dots-container">
            <span class="dot active"></span>
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
        </div>
    </div>
    </section>

  <section id="syllabus">
      <h2 class="text-3xl font-bold mb-6 text-purple-600 dark:text-purple-300 text-center">Year 3, 4 and 5 PS Syllabus</h2>
      <div class="space-y-6">
 
<div class="accordion-item">
  <div class="accordion-header">
    <h2 class="text-xl md:text-2xl font-bold text-purple-600 dark:text-purple-400">
      Key Stage 1 - Year 3 Syllabus
    </h2>
    <svg class="accordion-icon text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </div>
  <div class="accordion-panel">
    <div class="accordion-content space-y-4">

      <div class="accordion-item-sub">
        <div class="accordion-header">
          <h3 class="text-lg md:text-xl font-bold text-purple-500">Time Allocation</h3>
          <svg class="accordion-icon text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </div>
        <div class="accordion-panel">
          <div class="overflow-x-auto shadow-lg rounded-xl my-4">
            <table class="syllabus-table w-full text-sm text-left">
              <thead>
                <tr>
                  <th>Subject</th>
                  <th>Hours per Week</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>English</td>
                  <td>5h</td>
                </tr>
                <tr>
                  <td>Math</td>
                  <td>4h</td>
                </tr>
                <tr>
                  <td>Science</td>
                  <td>3h</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
 
        <div class="accordion-item">
            <div class="accordion-header">
                <h2 class="text-xl md:text-2xl font-bold text-purple-600 dark:text-purple-400">Key Stage 1 - Year 4 Syllabus</h2>
                <svg class="accordion-icon text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </div>
            <div class="accordion-panel">
                <div class="accordion-content space-y-4">
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <div class="accordion-header">
                <h2 class="text-xl md:text-2xl font-bold text-purple-600 dark:text-purple-400">Key Stage 1 - Year 5 Syllabus</h2>
                <svg class="accordion-icon text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </div>
            <div class="accordion-panel">
                 <div class="accordion-content space-y-4">
                 </div>
            </div>
        </div>

      </div>
  </section>
  
  <section id="topics">
    <h2 class="text-3xl font-bold mb-6 text-purple-600 dark:text-purple-300 text-center">Download The Didactic Guide of Primary School</h2>
    <div class="space-y-4">
        <a href="https://drive.google.com/uc?export=download&id=1-AYuZdlCW702Hk8X00FRoNRM2ERLKEfY" class="flex items-center p-6 rounded-2xl shadow-lg hover:shadow-xl bg-violet-100 dark:bg-violet-900/50 hover:bg-violet-200 dark:hover:bg-violet-900/80 transition-all transform hover:-translate-y-1 group">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-violet-600 dark:text-violet-400 mr-4 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 11.586V3a1 1 0 112 0v8.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
            <div>
                <h3 class="text-lg md:text-xl font-bold text-violet-800 dark:text-violet-200">Download The Didactic Guide for English for the Third and Fourth Year of Primary School</h3>
                <p class="text-violet-600 dark:text-violet-400 group-hover:text-violet-800 dark:group-hover:text-violet-200">Click here to start your download.</p>
            </div>
        </a>

        <a href="https://drive.google.com/uc?export=download&id=1--xytiEzXJDio9QdrH6ehTSwCho84WN3" class="flex items-center p-6 rounded-2xl shadow-lg hover:shadow-xl bg-violet-100 dark:bg-violet-900/50 hover:bg-violet-200 dark:hover:bg-violet-900/80 transition-all transform hover:-translate-y-1 group">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-violet-600 dark:text-violet-400 mr-4 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 11.586V3a1 1 0 112 0v8.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
            <div>
                <h3 class="text-lg md:text-xl font-bold text-violet-800 dark:text-violet-200">Download The Didactic Guide for English for the Fifth Year of Primary School</h3>
                <p class="text-violet-600 dark:text-violet-400 group-hover:text-violet-800 dark:group-hover:text-violet-200">Click here to start your download.</p>
            </div>
        </a>
    </div>
</section>

<section id="planning">
    <h2 class="text-3xl font-bold mb-6 text-purple-600 dark:text-purple-300">Feedback Corner</h2>
    <div class="feedback-container bg-white/70 dark:bg-gray-800/50 backdrop-blur-sm p-8 rounded-2xl shadow-lg">
        <form id="feedback-form" class="space-y-6">
            <div>
                <label for="comment-text" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">Your Feedback</label>
                <textarea id="comment-text" name="comment-text" rows="5" required class="w-full px-4 py-3 rounded-lg border-gray-300 dark:border-gray-600 bg-gray-50/50 dark:bg-gray-700/50 focus:ring-purple-500 focus:border-purple-500 transition" placeholder="Share your thoughts..."></textarea>
            </div>
            <button type="submit" id="submit-feedback-btn" class="w-full text-white font-bold py-3 px-6 rounded-lg transition transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500
                       bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed">
                Submit Feedback
            </button>
        </form>

        <div id="login-prompt" class="hidden text-center mt-6 p-4 bg-yellow-100/50 dark:bg-yellow-900/30 rounded-lg">
            <p class="text-gray-700 dark:text-yellow-200">
                You must be logged in to comment. 
                <a href="section3.html" class="text-purple-600 dark:text-purple-300 hover:underline font-bold">Sign up here</a>.
            </p>
        </div>

        <div id="comments-container" class="mt-12 space-y-6">
            </div>
    </div>
</section>
</main>

<footer id="page-footer" class="max-w-5xl mx-auto px-4 md:px-6 text-center" style="display: none;">
</footer>

<footer>
  <div class="text-center text-sm py-4 text-gray-500 dark:text-gray-400">
    Designed by <a href="https://facebook.com/bahloulidjaafar" target="_blank" class="text-indigo-600 dark:text-indigo-400 hover:underline">@Bahlouli djaafar</a>
  </div>
</footer>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // --- Navbar and Dark Mode Script ---
    const menuContainer = document.querySelector('nav .container');
    const underline = document.querySelector('.underline');
    const allLinks = document.querySelectorAll('#nav-links a');
    const toggleCheckbox = document.getElementById('dm-toggle');
    const body = document.body;
    const sliderIcon = document.getElementById('slider-icon');
    const lightIcon = "https://cdn-icons-png.flaticon.com/512/3258/3258157.png";
    const darkIcon = "https://cdn-icons-png.flaticon.com/512/4445/4445942.png";

    // --- Hamburger Menu Script ---
    const menuToggle = document.getElementById('menu-toggle');
    const navLinks = document.getElementById('nav-links');
    menuToggle.addEventListener('click', () => {
      menuToggle.classList.toggle('active');
      navLinks.classList.toggle('hidden');
      navLinks.classList.toggle('active');
    });

    function moveUnderline(element) {
      if (!element || window.innerWidth < 768) return; // Don't run on mobile
      const rect = element.getBoundingClientRect();
      const parentRect = menuContainer.getBoundingClientRect();
      const left = rect.left - parentRect.left + menuContainer.scrollLeft;
      const width = rect.width;
      underline.style.width = width + 'px';
      underline.style.left = left + 'px';
    }

    setTimeout(() => {
        const activeLink = document.querySelector('a.active') || allLinks[0];
        moveUnderline(activeLink);
    }, 50);

    // Dark mode initial load
    const storedTheme = localStorage.getItem('theme');
    if (storedTheme === 'dark') {
      body.classList.add('dark');
      toggleCheckbox.checked = true;
      sliderIcon.src = darkIcon;
    } else {
      sliderIcon.src = lightIcon;
    }

    allLinks.forEach(link => {
      link.addEventListener('mouseenter', () => moveUnderline(link));
      link.addEventListener('click', (e) => {
        allLinks.forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        
        if (window.innerWidth < 768) {
          menuToggle.classList.remove('active');
          navLinks.classList.add('hidden');
          navLinks.classList.remove('active');
        }

        if(link.getAttribute('href').startsWith('#')) {
          e.preventDefault();
          document.querySelector(link.getAttribute('href')).scrollIntoView({ behavior: 'smooth'});
        }
      });
    });
    
    menuContainer.addEventListener('mouseleave', () => {
        const activeLink = document.querySelector('a.active') || allLinks[0];
        moveUnderline(activeLink);
    });

    window.addEventListener('resize', () => {
      const activeLink = document.querySelector('a.active') || allLinks[0];
      moveUnderline(activeLink);
      if (window.innerWidth >= 768) {
        menuToggle.classList.remove('active');
        navLinks.classList.remove('active');
        navLinks.classList.add('hidden');
      }
    });

    // Dark mode toggle listener
    toggleCheckbox.addEventListener('change', () => {
      if (toggleCheckbox.checked) {
        body.classList.add('dark');
        sliderIcon.src = darkIcon;
        localStorage.setItem('theme', 'dark');
      } else {
        body.classList.remove('dark');
        sliderIcon.src = lightIcon;
        localStorage.setItem('theme', 'light');
      }
    });

    // --- Accordion Script ---
    const accordions = document.querySelectorAll('.accordion-header');
    accordions.forEach(header => {
      header.addEventListener('click', function () {
        const panel = this.nextElementSibling;
        const isOpen = this.classList.contains('active');
        this.classList.toggle('active');
        if (isOpen) {
          panel.style.maxHeight = panel.scrollHeight + "px";
          requestAnimationFrame(() => { panel.style.maxHeight = "0px"; });
        } else {
          panel.style.maxHeight = panel.scrollHeight + "px";
          panel.addEventListener('transitionend', () => {
            if (this.classList.contains('active')) panel.style.maxHeight = "none";
          }, { once: true });
        }
      });
    });
    
    // --- SLIDESHOW SCRIPT ---
    const slidesWrapper = document.querySelector('.slides-wrapper');
    const slides = document.querySelectorAll('.slide');
    const prevBtn = document.querySelector('.slide-btn.prev');
    const nextBtn = document.querySelector('.slide-btn.next');
    const dots = document.querySelectorAll('.dot');
    
    let currentIndex = 0;
    const totalSlides = slides.length;
    let slideInterval;

    function goToSlide(index) {
        if (index < 0) {
            index = totalSlides - 1;
        } else if (index >= totalSlides) {
            index = 0;
        }
        slidesWrapper.style.transform = `translateX(-${index * 100}%)`;
        dots.forEach(dot => dot.classList.remove('active'));
        dots[index].classList.add('active');
        currentIndex = index;
    }

    function nextSlide() {
        goToSlide(currentIndex + 1);
    }
    
    function startSlideShow() {
        stopSlideShow();
        slideInterval = setInterval(nextSlide, 5000);
    }

    function stopSlideShow() {
        clearInterval(slideInterval);
    }

    nextBtn.addEventListener('click', () => {
        nextSlide();
        stopSlideShow();
        startSlideShow();
    });
    
    prevBtn.addEventListener('click', () => {
        goToSlide(currentIndex - 1);
        stopSlideShow();
        startSlideShow();
    });

    dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
            goToSlide(index);
            stopSlideShow();
            startSlideShow();
        });
    });

    startSlideShow();
  });
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
import { 
  getFirestore, 
  doc, 
  getDoc, 
  collection, 
  addDoc, 
  serverTimestamp, 
  query, 
  orderBy, 
  onSnapshot 
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCVtWA2FqatlTRR1gSzCTNUSFYUAbAwLW0",
  authDomain: "printelydz.firebaseapp.com",
  projectId: "printelydz",
  storageBucket: "printelydz.appspot.com",
  messagingSenderId: "49201277305",
  appId: "1:49201205:web:df932043e4d6d986cae7a8",
  measurementId: "G-R4VJL5SR88"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const userInfoDiv = document.getElementById("user-info");
const feedbackForm = document.getElementById('feedback-form');
const commentTextarea = document.getElementById('comment-text');
const submitFeedbackBtn = document.getElementById('submit-feedback-btn');
const loginPrompt = document.getElementById('login-prompt');
const commentsContainer = document.getElementById('comments-container');
const signupNavLink = document.getElementById('signup-nav-link');
const headerTextContainer = document.getElementById('header-text-container');
const pageFooter = document.getElementById('page-footer');

const displayComments = () => {
  const commentsRef = collection(db, 'comments');
  const q = query(commentsRef, orderBy('timestamp', 'desc'));

  onSnapshot(q, (snapshot) => {
    commentsContainer.innerHTML = '';
    snapshot.forEach((doc) => {
      const comment = doc.data();
      const commentElement = document.createElement('div');
      commentElement.className = 'p-6 rounded-xl bg-gray-100 dark:bg-gray-700/50 shadow-inner animate-fade-in-up';
      const date = comment.timestamp ? comment.timestamp.toDate().toLocaleString() : 'Just now';
      commentElement.innerHTML = `
        <div class="flex justify-between items-center">
            <h4 class="font-bold text-purple-600 dark:text-purple-300 text-lg">${comment.username}</h4>
            <span class="text-xs text-gray-500 dark:text-gray-400">${date}</span>
        </div>
        <p class="text-gray-700 dark:text-gray-300 mt-2 whitespace-pre-wrap">${comment.commentText}</p>
      `;
      commentsContainer.appendChild(commentElement);
    });
  });
};

onAuthStateChanged(auth, async (user) => {
  userInfoDiv.style.display = 'flex'; 
  pageFooter.style.display = 'block';

  if (user) {
    if (signupNavLink) {
        signupNavLink.style.display = 'none';
    }
    feedbackForm.style.display = 'block';
    loginPrompt.classList.add('hidden');
    commentTextarea.disabled = false;
    submitFeedbackBtn.disabled = false;
    const userDocRef = doc(db, "users", user.uid);
    const userDoc = await getDoc(userDocRef);
    const username = userDoc.exists() ? userDoc.data().username : user.email;
    headerTextContainer.innerHTML = `
        <h1 class="text-3xl md:text-4xl font-bold mb-4 animate-fade-in-down">
            Welcome back, ${username}!
        </h1>
        <h2 class="text-2xl md:text-5xl font-extrabold mb-4 tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-white to-purple-200 animate-fade-in-down" style="animation-delay: 0.2s;">
           Welcome to the Lesson Plan Builder
        </h2>
        <p class="text-lg md:text-2xl text-purple-100/90 animate-fade-in-up max-w-3xl mx-auto" style="animation-delay: 0.4s;">
            Let's create something amazing today.
        </p>
    `;
    userInfoDiv.innerHTML = `
      <a href="dashboard.html" title="Go to your account dashboard" class="flex items-center gap-2 text-gray-700 dark:text-gray-300 hover:text-purple-600 dark:hover:text-purple-400 transition-colors p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-8 h-8 p-1 bg-gray-200 dark:bg-gray-600 rounded-full" viewBox="0 0 16 16">
              <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
              <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
          </svg>
          <span class="font-medium text-sm md:text-base pr-2">Account</span>
      </a>
    `;
    pageFooter.innerHTML = `
        <div class="flex justify-center items-center gap-4">
            <a href="dashboard.html" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-bold shadow-lg transform hover:scale-105">Go to Dashboard</a>
            <button id="footer-logout-btn" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-bold shadow-lg transform hover:scale-105">Sign Out</button>
        </div>
    `;
    document.getElementById("footer-logout-btn").addEventListener("click", () => signOut(auth));

    feedbackForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const commentText = commentTextarea.value.trim();
        if (commentText === '') return;
        try {
            await addDoc(collection(db, "comments"), {
                userId: user.uid,
                username: username,
                commentText: commentText,
                timestamp: serverTimestamp()
            });
            feedbackForm.reset();
        } catch (error) {
            console.error("Error adding document: ", error);
            alert("Sorry, there was an error submitting your feedback.");
        }
    });

  } else {
    headerTextContainer.innerHTML = `
        <h2 class="text-4xl md:text-6xl font-extrabold mb-4 tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-white to-purple-200 animate-fade-in-down">
            Welcome to the Lesson Plan Builder
        </h2>
        <p class="text-lg md:text-2xl text-purple-100/90 animate-fade-in-up max-w-3xl mx-auto">
            Customize your lesson plan in a few easy steps
        </p>
    `;
    if (signupNavLink) {
        signupNavLink.style.display = 'block';
    }
    userInfoDiv.innerHTML = `<a href="login.html" class="px-3 py-1 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm">Login</a>`;
    feedbackForm.style.display = 'none';
    loginPrompt.classList.remove('hidden');
    commentTextarea.disabled = true;
    submitFeedbackBtn.disabled = true;
    pageFooter.innerHTML = `
        <button id="footer-logout-btn" class="px-6 py-2 bg-gray-400 text-white rounded-lg font-bold shadow-lg cursor-not-allowed" disabled title="You must be logged in to sign out">Sign Out</button>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">You are not logged in.</p>
    `;
  }
});

displayComments();
</script>

</body>
</html>