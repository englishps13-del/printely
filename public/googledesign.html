<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lesson Plan with Ribbon Editor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;700&family=Rubik+Doodle+Shadow&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />  
  <style>
    :root {
      --paper-color: #ffffff;
      --background-color: #ffffff;
      --primary-text: #2c3e50;
      --secondary-text: #7f8c8d;
      --header-color: #8e44ad;
      --line-color: #dcdcdc;
      --box-bg: #f9f9f9;
      --box-border: #e0e0e0;
      --title-font: 'Rubik Doodle Shadow', sans-serif;
      --body-font: 'Quicksand', sans-serif;
    }

       /* Base styles with Doodle theme as default */
        :root {
            --paper-color: #ffffff;
            --background-color: #ffffff;
            --primary-text: #2c3e50;
            --secondary-text: #7f8c8d;
            --header-color: #8e44ad;
            --line-color: #dcdcdc;
            --box-bg-new: #f9f9f9;
            --new-box-border: #e0e0e0;
        }

        /* Theme-specific variables */
        .theme-minimalist {
            --primary-text: #334e68;
            --secondary-text: #6d8093;
            --header-color: #5585b5;
            --line-color: #e2e8f0;
            --box-bg-new: #f7f9fc;
            --new-box-border: #cdd9e8;
   --title-font: 'Rubik Doodle Shadow', sans-serif;
--body-font: 'Quicksand', sans-serif;
        }

        .theme-vibrant {
            --primary-text: #2c3e50;
            --secondary-text: #7f8c8d;
            --header-color: #e74c3c;
            --line-color: #f39c12;
            --box-bg-new: #fdf3f0;
            --new-box-border: #e74c3c;
            --title-font: 'Quicksand', sans-serif;
            --body-font: 'Quicksand', sans-serif;
        }

        /* 10 New Themes */
        .theme-autumn {
            --primary-text: #5D4037;
            --secondary-text: #8D6E63;
            --header-color: #E65100;
            --line-color: #A5D6A7;
            --box-bg-new: #FFF3E0;
            --new-box-border: #FFAB91;
        }
        .theme-spring {
            --primary-text: #6A1B9A;
            --secondary-text: #9575CD;
            --header-color: #C8E6C9;
            --line-color: #B2EBF2;
            --box-bg-new: #F1F8E9;
            --new-box-border: #B9F6CA;
        }
        .theme-fire {
            --primary-text: #BF360C;
            --secondary-text: #FFAB91;
            --header-color: #D32F2F;
            --line-color: #FFCDD2;
            --box-bg-new: #FFCDD2;
            --new-box-border: #FF5252;
        }
        .theme-ice {
            --primary-text: #283593;
            --secondary-text: #5C6BC0;
            --header-color: #81D4FA;
            --line-color: #B3E5FC;
            --box-bg-new: #E1F5FE;
            --new-box-border: #4FC3F7;
        }
        .theme-grapevine {
            --primary-text: #4A148C;
            --secondary-text: #7B1FA2;
            --header-color: #BA68C8;
            --line-color: #D1C4E9;
            --box-bg-new: #F3E5F5;
            --new-box-border: #E1BEE7;
        }
        .theme-skyline {
            --primary-text: #263238;
            --secondary-text: #546E7A;
            --header-color: #78909C;
            --line-color: #9E9E9E;
            --box-bg-new: #ECEFF1;
            --new-box-border: #B0BEC5;
        }
        .theme-beach {
            --primary-text: #795548;
            --secondary-text: #BCAAA4;
            --header-color: #FFB74D;
            --line-color: #B3E5FC;
            --box-bg-new: #FFFDE7;
            --new-box-border: #FFE0B2;
        }
        .theme-cityscape {
            --primary-text: #455A64;
            --secondary-text: #9E9E9E;
            --header-color: #607D8B;
            --line-color: #CFD8DC;
            --box-bg-new: #F5F5F5;
            --new-box-border: #BDBDBD;
        }
        .theme-lavender {
            --primary-text: #6A1B9A;
            --secondary-text: #7B1FA2;
            --header-color: #D1C4E9;
            --line-color: #E1BEE7;
            --box-bg-new: #F3E5F5;
            --new-box-border: #E1BEE7;
        }
        .theme-mint {
            --primary-text: #004D40;
            --secondary-text: #26A69A;
            --header-color: #4DB6AC;
            --line-color: #B2DFDB;
            --box-bg-new: #E0F2F1;
            --new-box-border: #B9F6CA;
        }


    body {
      font-family: var(--body-font);
      background: var(--background-color);
      margin: 0;
      padding: 40px;
      display: flex;
      justify-content: center;
    }

    .lesson-plan-container {
      width: 8.5in;
      min-height: 11in;
      background: var(--paper-color);
      border: 1px solid var(--line-color);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      padding: 40px;
      display: flex;
      flex-direction: column;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-family: var(--title-font);
      font-size: 3rem;
      color: var(--header-color);
      margin: 0;
      line-height: 1;
    }

.meta-info {
  display: flex;
  flex-direction: column;
  gap: 12px; /* spacing between rows */
}

    .meta-item {
      display: flex;
      align-items: center;
    }

    .meta-item label {
      font-size: 0.55rem;
      text-transform: uppercase;
      font-weight: 500;
      color: var(--primary-text);
      margin-right: 10px;
    }

    .meta-item input {
      flex-grow: 1;
      border: none;
      border-bottom: 2px solid var(--header-color);
      font-family: var(--body-font);
      font-size: 1rem;
      padding: 4px 0;
      background: transparent;
      font-weight: 500;
      color: var(--primary-text);
      outline: none;
    }

    .section {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
      border: 1px solid var(--line-color);
      border-radius: 8px;
      padding: 25px 20px 20px;
      position: relative;
      background: var(--box-bg);
    }

    .section-title {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--paper-color);
      padding: 5px 15px;
      border: 1px solid var(--line-color);
      border-radius: 5px;
      font-size: 0.9rem;
      text-transform: uppercase;
      font-weight: 700;
      color: var(--header-color);
      letter-spacing: 0.5px;
    }

    textarea, select, input {
      width: 100%;
      border: none;
      outline: none;
      font-family: var(--body-font);
      font-size: 0.95rem;
      line-height: 1.6;
      background: transparent;
      color: var(--primary-text);
      padding: 5px;
      min-height: 40px;
    }

    .two-column-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .three-column-layout {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 15px;
    }

    .footer {
      text-align: center;
      font-size: 0.8rem;
      color: var(--secondary-text);
      margin-top: auto;
      padding-top: 15px;
      border-top: 1px dashed var(--line-color);
    }

    .controls {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .theme-switcher select, .action-button {
      font-family: 'Quicksand', sans-serif;
      font-size: 0.9rem;
      padding: 8px 12px;
      border: 1px solid var(--line-color);
      border-radius: 5px;
      background-color: var(--paper-color);
      color: var(--primary-text);
      cursor: pointer;
      outline: none;
      transition: all 0.2s ease-in-out;
    }
    
    .action-button:disabled {
        background-color: #e0e0e0;
        cursor: not-allowed;
        color: #9e9e9e;
    }

    .action-button:hover:not(:disabled) {
      background-color: var(--header-color);
      color: var(--paper-color);
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

   .new-box {
      border: 1px solid var(--new-box-border);
      border-radius: 8px;
      background-color: var(--box-bg-new);
      padding: 20px;
      margin-bottom: 20px;
    }

    .new-box .new-title {
      font-size: 1rem;
      font-weight: 700;
      text-transform: uppercase;
      text-align: center;
      color: var(--header-color); /* stays theme-aware */
      margin-bottom: 12px;
      border-bottom: 2px solid var(--header-color);
      padding-bottom: 4px;
    }


    .checkbox-inline {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      font-size: 0.8rem;
      color: var(--primary-text);
    }

    .checkbox-inline label {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .new-box .new-title {
      font-size: 1rem;
      font-weight: 700;
      text-transform: uppercase;
      text-align: center;
      color: var(--header-color);   /* same purple as other titles */
      margin-bottom: 12px;
      border-bottom: 2px solid var(--header-color);
      padding-bottom: 4px;
    }
    .checkbox-inline {
      display: flex;
      justify-content: center;   /* center them in the box */
      gap: 20px;                 /* spacing between checkboxes */
      font-size: 0.8rem;          /* smaller text */
      flex-wrap: nowrap;          /* force single line */
    }

    .checkbox-inline label {
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;       /* prevent wrapping to new line */
    }

    .checkbox-inline input {
      transform: scale(0.9);     /* slightly smaller checkboxes */
    }

    /* Smaller headers for compact sections */
    .section-title.small-title {
      font-size: 0.75rem;   /* smaller font */
      padding: 2px 10px;
      min-width: 150px;     /* force them a bit wider */
      text-align: center;
    }
    .lesson-details-grid {
      display: grid;
      grid-template-columns: 30% 70%;
      grid-template-rows: auto auto auto;
      gap: 10px 15px;
    }
    .lesson-details-grid select {
      width: 100%;
      padding: 6px;
      border: none;              /* remove border */
      border-bottom: 2px solid var(--header-color); /* optional underline only */
      border-radius: 0;          /* no rounded corners */
      background: transparent;   /* match paper background */
      font-size: 0.9rem;
      outline: none;             /* remove focus border */
    }
	
    /* Make second row and third row span full width */
    .lesson-details-grid .full-width {
      grid-column: 1 / span 2;
    }
    .meta-info {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 15px;
      margin-bottom: 25px;
      align-items: center; /* make labels + inputs align vertically */
    }

    .meta-item {
      display: flex;
      align-items: center; /* keeps label and underline on same line */
      gap: 5px;
    }

    .meta-item label {
      font-size: 0.7rem;
      text-transform: uppercase;
      font-weight: 800;
      color: var(--primary-text);
      white-space: nowrap; /* prevents breaking into 2 lines */
    }

    .meta-item input {
      flex-grow: 1;
      border: none;
      border-bottom: 1px solid var(--header-color);
      font-size: 0.95rem;
      padding: 0px 0;
      background: transparent;
      outline: none;
      font-weight: 500;
      color: var(--primary-text);
    }

    /* Default / Doodle */
    :root {
      --checkbox1: #8e44ad;
      --checkbox2: #2980b9;
      --checkbox3: #27ae60;
      --checkbox4: #d35400;
    }

    /* Minimalist */
    .theme-minimalist {
      --checkbox1: #5585b5;
      --checkbox2: #334e68;
      --checkbox3: #6d8093;
      --checkbox4: #99aabb;
    }

    /* Vibrant */
    .theme-vibrant {
      --checkbox1: #e74c3c; /* red */
      --checkbox2: #f39c12; /* orange */
      --checkbox3: #27ae60; /* green */
      --checkbox4: #2980b9; /* blue */
    }

    /* Autumn */
    .theme-autumn {
      --checkbox1: #E65100; /* deep orange */
      --checkbox2: #FF7043; /* lighter orange */
      --checkbox3: #5D4037; /* brown */
      --checkbox4: #8D6E63; /* light brown */
    }

    /* Spring */
    .theme-spring {
      --checkbox1: #6A1B9A; /* purple */
      --checkbox2: #9575CD; /* lavender */
      --checkbox3: #43A047; /* green */
      --checkbox4: #81C784; /* light green */
    }

    /* Fire */
    .theme-fire {
      --checkbox1: #BF360C; /* dark red */
      --checkbox2: #D32F2F; /* strong red */
      --checkbox3: #FF5722; /* orange red */
      --checkbox4: #FFAB91; /* peach */
    }

    /* Ice */
    .theme-ice {
      --checkbox1: #81D4FA;
      --checkbox2: #4FC3F7;
      --checkbox3: #0288D1;
      --checkbox4: #01579B;
    }

    /* Grapevine */
    .theme-grapevine {
      --checkbox1: #4A148C; /* dark purple */
      --checkbox2: #7B1FA2; /* purple */
      --checkbox3: #BA68C8; /* lighter purple */
      --checkbox4: #E1BEE7; /* lavender */
    }

    /* Skyline */
    .theme-skyline {
      --checkbox1: #263238; /* dark gray */
      --checkbox2: #455A64; /* medium gray-blue */
      --checkbox3: #607D8B; /* blue gray */
      --checkbox4: #90A4AE; /* light gray */
    }

    /* Beach */
    .theme-beach {
      --checkbox1: #FFB74D; /* orange sand */
      --checkbox2: #4FC3F7; /* sea blue */
      --checkbox3: #26A69A; /* aqua */
      --checkbox4: #795548; /* brown driftwood */
    }

    /* Cityscape */
    .theme-cityscape {
      --checkbox1: #455A64; /* steel gray */
      --checkbox2: #607D8B; /* gray-blue */
      --checkbox3: #9E9E9E; /* neutral */
      --checkbox4: #BDBDBD; /* light concrete */
    }

    /* Lavender */
    .theme-lavender {
      --checkbox1: #6A1B9A; /* deep purple */
      --checkbox2: #8E24AA; /* medium purple */
      --checkbox3: #BA68C8; /* soft purple */
      --checkbox4: #E1BEE7; /* pastel lavender */
    }

    /* Mint */
    .theme-mint {
      --checkbox1: #004D40; /* deep teal */
      --checkbox2: #26A69A; /* teal */
      --checkbox3: #4DB6AC; /* mint green */
      --checkbox4: #B9F6CA; /* light mint */
    }

    /* Apply per-checkbox coloring */
    .checkbox-inline label:nth-child(1) input { accent-color: var(--checkbox1); }
    .checkbox-inline label:nth-child(2) input { accent-color: var(--checkbox2); }
    .checkbox-inline label:nth-child(3) input { accent-color: var(--checkbox3); }
    .checkbox-inline label:nth-child(4) input { accent-color: var(--checkbox4); }


    /* Make the paper exactly A4 with no browser margins */
    /* A4 page with a tiny margin so borders always show */
    @page { 
      size: A4; 
      margin: 0.1mm;   /* minimal margin so page border prints */
    }

    @media print {
      html, body {
        margin: 0 !important;
        padding: 0 !important;
        height: auto !important;
        background: transparent !important;
      }

      .controls, .no-print, .ribbon { display: none !important; }

      .lesson-plan-container {
        width: 210mm !important;
        height: 296.5mm !important; 
        margin: 0 auto !important;
        padding: 8mm !important;   /* reduce padding slightly */
        border: 2px solid var(--line-color) !important;
        background: #fff !important;
        box-sizing: border-box !important;

        transform: scale(1);    /* shrink to fit */
        transform-origin: top left;
      }

      /* prevent sections from forcing new page */
      .section {
        page-break-inside: avoid !important;
      }

      .section.install-resources,
      .section:nth-of-type(3) {
        min-height: 100px !important;  /* smaller for print */
      }


      /* Typography and spacing */
      .header h1 { font-size: 2.4rem !important; }
      .meta-info { gap: 10px !important; }
      .meta-item label { font-size: 0.8rem !important; }
      .meta-item input { font-size: 0.9rem !important; }

      .section { margin-bottom: 10px !important; padding: 15px 10px !important; }
      .section-title { font-size: 0.8rem !important; padding: 3px 10px !important; }
      .section-title.small-title { font-size: 0.7rem !important; min-width: 120px !important; }
      .two-column-layout, .three-column-layout { gap: 10px !important; }

      /* Install resources box bigger */
      .section.install-resources, .section:nth-of-type(3) { min-height: 150px !important; }

      textarea, select, input, .editable-area { font-size: 0.8rem !important; min-height: 20px !important; }

      /* Dropdowns: underline + hide arrow */
      .lesson-details-grid select {
        border: none !important;
        border-bottom: 1px solid var(--header-color) !important;
        background: transparent !important;
        appearance: none !important;
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
        box-shadow: none !important;
        padding: 2px 0 !important;
      }
      select::-ms-expand { display: none !important; }

      /* Ensure theme colors print */
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }

    
    /* Resizable textarea */
    .resizable-textarea {
      resize: vertical;
      overflow: auto;
      min-height: 100px;
    }
	
    /* One-line compressed textareas for Warmer & Assessment */
    .small-textarea {
      min-height: 15px !important;
      height: 15px !important;
      resize: none !important;
      overflow: hidden !important;
      line-height: 1.2;
      font-size: 0.65rem;
      padding: 2px 4px;
    }
    /* Wrapper: places General Info and Lesson Details side by side */
    .top-split {
      display: grid;
      grid-template-columns: 44% 54%; /* 35% General Info, 65% Lesson Details */
      gap: 10px;
    }

    /* Lesson details layout inside its box */
    .lesson-details-grid {
      display: grid;
      grid-template-columns: 20% 75%;
      gap: 10px 15px;
    }

    .lesson-details-grid .full-width {
      grid-column: 1 / -1;
    }

    /* --- RIBBON & EDITABLE AREA STYLES --- */
    .ribbon {
        display: flex; flex-wrap: wrap; gap: 8px; align-items: stretch;
        background: var(--box-bg-new);
        border: 1px solid var(--new-box-border);
        border-radius: 8px;
        padding: 10px;
        margin-bottom: 24px;
    }

    .group {
        display: flex; align-items: center; gap: 6px;
        padding: 6px;
        border: 1px solid var(--line-color);
        border-radius: 6px;
        background: var(--paper-color);
    }

    .group .label { font-size: 12px; color: var(--secondary-text); margin-left: 4px; white-space: nowrap; }

    .ribbon select, .ribbon input[type="color"], .ribbon .btn, .ribbon .btn-square {
        appearance: none; border: 1px solid var(--line-color); background: var(--paper-color);
        padding: 7px 10px; border-radius: 5px; font-size: 14px;
        line-height: 1; cursor: pointer; color: var(--primary-text);
        font-family: var(--body-font);
    }

    .ribbon .btn, .ribbon .btn-square { display: inline-flex; align-items: center; justify-content: center; gap: 6px; }
    .ribbon .btn-square { width: 36px; height: 36px; padding: 0; }

    .ribbon .btn:hover, .ribbon .btn-square:hover, .ribbon select:hover { background-color: var(--box-bg-new); }
    .ribbon .btn.active, .ribbon .btn-square.active { 
        background: var(--header-color); color: var(--paper-color); border-color: var(--header-color); 
    }
    .ribbon .sep { width: 1px; background: var(--line-color); margin: 0 6px; align-self: stretch; }
    .ribbon .grow { flex: 1 1 auto; }
    .ribbon .pill {
        font-size: 12px; padding: 4px 8px; border-radius: 999px; 
        border: 1px solid var(--line-color); 
        background: var(--paper-color); color: var(--secondary-text);
    }
    
    .editable-area {
        width: 100%;
        border: none;
        outline: none;
        font-family: var(--body-font);
        font-size: 0.95rem;
        line-height: 1.6;
        background: transparent;
        color: var(--primary-text);
        padding: 5px;
        min-height: 40px;
        cursor: text;
    }

    .editable-area:focus {
        outline: none;
        box-shadow: 0 0 0 2px var(--header-color);
        border-radius: 4px;
    }

    .editable-area[data-placeholder]:empty::before {
        content: attr(data-placeholder);
        color: var(--secondary-text);
        pointer-events: none;
        font-style: italic;
    }

    /* --- NEW: Modal & Toast & Loader Styles --- */
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); display: none; justify-content: center; align-items: center; z-index: 1000;
    }
    .modal-content {
      background-color: var(--paper-color); padding: 25px; border-radius: 8px; width: 90%; max-width: 500px; text-align: center; position: relative; font-family: 'Quicksand', sans-serif;
      border: 2px solid var(--header-color);
    }
    .modal-close-btn {
      position: absolute; top: 10px; right: 15px; font-size: 24px; font-weight: bold; cursor: pointer; color: var(--secondary-text);
    }
    .modal-content h2 { margin-top: 0; margin-bottom: 15px; color: var(--primary-text);}
    .modal-content p { margin-bottom: 20px; color: var(--secondary-text); }
    .modal-content input[type="text"] {
      box-sizing: border-box; width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid var(--line-color); border-radius: 4px; font-size: 16px; min-height: auto;
    }
    .modal-content button {
      background-color: var(--header-color); color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; width: 100%;
    }
    .modal-content button:hover { opacity: 0.8; }
    
    .loading-indicator {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.8); display: none; justify-content: center; align-items: center; z-index: 2000;
    }
    .loading-spinner {
      border: 5px solid #f3f3f3; border-top: 5px solid var(--header-color); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .toast {
      position: fixed; bottom: 20px; right: 20px; background: var(--primary-text); color: var(--paper-color); padding: 16px 24px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      display: flex; align-items: center; z-index: 1000; transform: translateY(100px); opacity: 0; transition: transform 0.3s ease, opacity 0.3s ease;
    }
    .toast.show { transform: translateY(0); opacity: 1; }
    .toast i { margin-right: 12px; font-size: 20px; }
    .toast.success { background-color: #27ae60; }
    .toast.error { background-color: #e74c3c; }

  </style>
</head>
<body class="theme-doodle">
  <div class="controls">
    <div class="theme-switcher">
        <label for="theme-selector">Theme:</label>
        <select id="theme-selector">
            <option value="doodle">Doodle</option>
            <option value="minimalist">Minimalist</option>
            <option value="vibrant">Vibrant</option>
            <option value="autumn">Autumn</option>
            <option value="spring">Spring</option>
            <option value="fire">Fire</option>
            <option value="ice">Ice</option>
            <option value="grapevine">Grapevine</option>
            <option value="skyline">Skyline</option>
            <option value="beach">Beach</option>
            <option value="cityscape">Cityscape</option>
            <option value="lavender">Lavender</option>
            <option value="mint">Mint</option>
        </select>
    </div>
    <button class="action-button" onclick="window.print()">
      <i class="fas fa-print"></i> Print
    </button>
    <button class="action-button" id="save-button" disabled title="Login to save">
      <i class="fas fa-save"></i> Save
    </button>
  </div>
  
  <div class="lesson-plan-container">
    <div class="header">
      <h1>Lesson Plan</h1>
    </div>

    <div class="ribbon" id="ribbon">
        <div class="group" aria-label="Font">
          <select id="fontFamily" title="Font family">
            <option>Quicksand</option><option>Rubik Doodle Shadow</option><option>Arial</option><option>Helvetica</option><option>Times New Roman</option><option>Georgia</option><option>Verdana</option><option>Courier New</option>
          </select>
          <select id="fontSize" title="Font size">
            <option value="10">10</option><option value="12">12</option><option value="14" selected>14</option><option value="16">16</option><option value="18">18</option><option value="20">20</option><option value="24">24</option><option value="28">28</option><option value="32">32</option><option value="40">40</option><option value="48">48</option>
          </select>
          <button class="btn-square" id="fontDec" title="Decrease font size">A-</button>
          <button class="btn-square" id="fontInc" title="Increase font size">A+</button>
        </div>

        <div class="group" aria-label="Emphasis">
          <button class="btn-square" data-cmd="bold" title="Bold (Ctrl+B)"><b>B</b></button>
          <button class="btn-square" data-cmd="italic" title="Italic (Ctrl+I)"><i>I</i></button>
          <button class="btn-square" data-cmd="underline" title="Underline (Ctrl+U)"><u>U</u></button>
          <button class="btn-square" data-cmd="strikeThrough" title="Strikethrough"><s>S</s></button>
          <button class="btn-square" data-cmd="superscript" title="Superscript">x<sup>2</sup></button>
          <button class="btn-square" data-cmd="subscript" title="Subscript">x<sub>2</sub></button>
        </div>

        <div class="group" aria-label="Colors">
          <label class="label" for="foreColor">Text</label>
          <input type="color" id="foreColor" title="Text color" value="#3d4852">
          <span class="sep"></span>
          <label class="label" for="hiliteColor">Highlight</label>
          <input type="color" id="hiliteColor" title="Highlight color" value="#fff59d">
        </div>

        <div class="group" aria-label="Paragraph">
          <button class="btn-square" data-cmd="justifyLeft" title="Align Left"><i class="fa-solid fa-align-left"></i></button>
          <button class="btn-square" data-cmd="justifyCenter" title="Align Center"><i class="fa-solid fa-align-center"></i></button>
          <button class="btn-square" data-cmd="justifyRight" title="Align Right"><i class="fa-solid fa-align-right"></i></button>
          <button class="btn-square" data-cmd="justifyFull" title="Justify"><i class="fa-solid fa-align-justify"></i></button>
          <span class="sep"></span>
          <button class="btn-square" data-cmd="insertUnorderedList" title="Bullet list"><i class="fa-solid fa-list-ul"></i></button>
          <button class="btn-square" data-cmd="insertOrderedList" title="Numbered list"><i class="fa-solid fa-list-ol"></i></button>
          <button class="btn-square" data-cmd="outdent" title="Outdent"><i class="fa-solid fa-outdent"></i></button>
          <button class="btn-square" data-cmd="indent" title="Indent"><i class="fa-solid fa-indent"></i></button>
        </div>

        <div class="group" aria-label="Actions">
          <button class="btn" data-cmd="removeFormat" title="Clear formatting (selection)"><i class="fas fa-remove-format"></i> Clear</button>
        </div>

        <div class="grow"></div>

        <div class="group">
          <span class="pill" id="wordCount">0 words</span>
          <span class="pill" id="selectionInfo">No selection</span>
        </div>
    </div>


    <div class="top-split">
      <div class="section">
        <div class="section-title small-title" >General Information</div>
        <div class="meta-info">
          <div class="meta-item">
            <label for="school">Primary School:</label>
            <input type="text" id="school">
          </div>
          <div class="meta-item">
            <label for="teacher">Teacher:</label>
            <input type="text" id="teacher">
          </div>
          <div class="meta-item">
            <label for="learners">Number of Learners:</label>
            <input type="text" id="learners">
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Lesson Details</div>
        <div class="lesson-details-grid">
          <select id="levelSelect"><option value="">Select Level</option></select>
          <select id="sequenceSelect"><option value="">Select Sequence</option></select>
          <select id="sectionSelect" class="full-width"><option value="">Select Section</option></select>
          <select id="sessionSelect" class="full-width"><option value="">Select Session</option></select>
        </div>
      </div>
    </div>

    <div class="new-box">
      <div class="new-title">Learning Objectives</div>
      <div id="objectives" class="editable-area" contenteditable="true" data-placeholder="Write learning objectives here..."></div>
    </div>

    <div class="two-column-layout">
      <div class="section">
        <div class="section-title small-title">Target Competencies</div>
        <div class="checkbox-inline" id="competencies">
          <label><input type="checkbox" value="Interact"> Interact</label>
          <label><input type="checkbox" value="Interpret"> Interpret</label>
          <label><input type="checkbox" value="Produce"> Produce</label>
        </div>
      </div>

      <div class="section">
        <div class="section-title small-title">Teaching Materials</div>
        <div class="checkbox-inline" id="materials">
          <label><input type="checkbox" value="Textbook"> Textbook</label>
          <label><input type="checkbox" value="W.B"> W.B</label>
        </div>
      </div>
    </div>


    <div class="section">
        <div class="section-title">Warmer</div>
        <div class="three-column-layout">
            <div id="warmer-procedure" class="editable-area small-textarea" contenteditable="true" data-placeholder="Procedure"></div>
            <div id="warmer-interaction" class="editable-area small-textarea" contenteditable="true" data-placeholder="Interaction"></div>
            <div id="warmer-time" class="editable-area small-textarea" contenteditable="true" data-placeholder="Time"></div>
        </div>
    </div>

    <div class="section">
      <div class="section-title">Install Resources</div>
      <div class="three-column-layout">
        <div id="install-procedure" class="editable-area resizable-textarea" contenteditable="true" data-placeholder="Procedure"></div>
        <div id="install-interaction" class="editable-area resizable-textarea" contenteditable="true" data-placeholder="Interaction"></div>
        <div id="install-time" class="editable-area resizable-textarea" contenteditable="true" data-placeholder="Time"></div>
      </div>
    </div>

    <div class="section">
        <div class="section-title">Assessment</div>
        <div class="three-column-layout">
            <div id="assessment-procedure" class="editable-area small-textarea" contenteditable="true" data-placeholder="Procedure"></div>
            <div id="assessment-interaction" class="editable-area small-textarea" contenteditable="true" data-placeholder="Interaction"></div>
            <div id="assessment-time" class="editable-area small-textarea" contenteditable="true" data-placeholder="Time"></div>
        </div>
    </div>

    <div class="new-box">
      <div class="new-title">Activity / Summary</div>
      <div id="activity-summary" class="editable-area" contenteditable="true" data-placeholder="Write activity or summary here..."></div>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div id="loadingIndicator" class="loading-indicator">
    <div class="loading-spinner"></div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast">
    <i id="toast-icon" class="fas fa-check-circle"></i>
    <span id="toast-message">Success!</span>
  </div>

  <!-- Save Modal -->
  <div id="saveModal" class="modal-overlay">
    <div class="modal-content">
      <span class="modal-close-btn">&times;</span>
      <h2>Save Lesson Plan</h2>
      <p>Please enter a name for this lesson plan.</p>
      <input type="text" id="planNameInput" placeholder="e.g., Grade 5 - Week 2 - Reading" />
      <button id="confirmSaveBtn">Save Plan</button>
    </div>
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script type="module">
    // --- IMPORT FIREBASE MODULES ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, addDoc, collection, serverTimestamp, updateDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    // --- FIREBASE CONFIGURATION ---
    const firebaseConfig = {
      apiKey: "AIzaSyCVtWA2FqatlTRR1gSzCTNUSFYUAbAwLW0",
      authDomain: "printelydz.firebaseapp.com",
      projectId: "printelydz",
      storageBucket: "printelydz.appspot.com",
      messagingSenderId: "49201277305",
      appId: "1:49201277305:web:df932043e4d6d986cae7a8",
      measurementId: "G-R4VJL5SR88"
    };

    // --- INITIALIZE FIREBASE ---
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- DOM ELEMENTS ---
    const saveButton = document.getElementById('save-button');
    const saveModal = document.getElementById('saveModal');
    const closeModalBtn = document.querySelector('.modal-close-btn');
    const planNameInput = document.getElementById('planNameInput');
    const confirmSaveBtn = document.getElementById('confirmSaveBtn');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toast-message');
    const toastIcon = document.getElementById('toast-icon');

    let currentUser = null;
    let currentPlanId = null;
    let isEditMode = false;
    
    // --- HELPER FUNCTIONS ---
    function showLoading() { loadingIndicator.style.display = 'flex'; }
    function hideLoading() { loadingIndicator.style.display = 'none'; }

    function showToast(message, type = 'success') {
      toastMessage.textContent = message;
      toast.className = `toast show ${type}`;
      toastIcon.className = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
      setTimeout(() => { toast.classList.remove('show'); }, 3000);
    }

    // --- AUTHENTICATION ---
    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUser = user;
        saveButton.disabled = false;
        saveButton.title = "Save your lesson plan";

        const planToLoadId = sessionStorage.getItem('planToLoadId');
        if (planToLoadId) {
            loadPlan(planToLoadId);
            sessionStorage.removeItem('planToLoadId');
        }
      } else {
        currentUser = null;
        saveButton.disabled = true;
        saveButton.title = "You must be logged in to save";
      }
    });

    // --- SAVE & LOAD LOGIC ---
    function collectPlanData() {
        const getCheckedValues = (containerId) => {
            const values = [];
            document.querySelectorAll(`#${containerId} input[type="checkbox"]:checked`).forEach(cb => values.push(cb.value));
            return values;
        };

        return {
            school: document.getElementById('school').value,
            teacher: document.getElementById('teacher').value,
            learners: document.getElementById('learners').value,
            level: document.getElementById('levelSelect').value,
            sequence: document.getElementById('sequenceSelect').value,
            section: document.getElementById('sectionSelect').value,
            session: document.getElementById('sessionSelect').value,
            objectives: document.getElementById('objectives').innerHTML,
            competencies: getCheckedValues('competencies'),
            materials: getCheckedValues('materials'),
            warmer: {
                procedure: document.getElementById('warmer-procedure').innerHTML,
                interaction: document.getElementById('warmer-interaction').innerHTML,
                time: document.getElementById('warmer-time').innerHTML,
            },
            install: {
                procedure: document.getElementById('install-procedure').innerHTML,
                interaction: document.getElementById('install-interaction').innerHTML,
                time: document.getElementById('install-time').innerHTML,
            },
            assessment: {
                procedure: document.getElementById('assessment-procedure').innerHTML,
                interaction: document.getElementById('assessment-interaction').innerHTML,
                time: document.getElementById('assessment-time').innerHTML,
            },
            activitySummary: document.getElementById('activity-summary').innerHTML,
            plannerType: 'google', // Discriminator field
            theme: document.documentElement.className,
        };
    }

    function populateForm(data) {
        const setCheckedValues = (containerId, values) => {
            document.querySelectorAll(`#${containerId} input[type="checkbox"]`).forEach(cb => {
                cb.checked = values.includes(cb.value);
            });
        };

        document.getElementById('school').value = data.school || '';
        document.getElementById('teacher').value = data.teacher || '';
        document.getElementById('learners').value = data.learners || '';
        document.getElementById('levelSelect').value = data.level || '';
        
        // Trigger change events to populate dependent dropdowns
        levelSelect.dispatchEvent(new Event('change'));
        setTimeout(() => {
            sequenceSelect.value = data.sequence || '';
            sequenceSelect.dispatchEvent(new Event('change'));
            setTimeout(() => {
                sectionSelect.value = data.section || '';
                sectionSelect.dispatchEvent(new Event('change'));
                setTimeout(() => {
                    sessionSelect.value = data.session || '';
                }, 100);
            }, 100);
        }, 100);

        document.getElementById('objectives').innerHTML = data.objectives || '';
        setCheckedValues('competencies', data.competencies || []);
        setCheckedValues('materials', data.materials || []);

        document.getElementById('warmer-procedure').innerHTML = data.warmer?.procedure || '';
        document.getElementById('warmer-interaction').innerHTML = data.warmer?.interaction || '';
        document.getElementById('warmer-time').innerHTML = data.warmer?.time || '';

        document.getElementById('install-procedure').innerHTML = data.install?.procedure || '';
        document.getElementById('install-interaction').innerHTML = data.install?.interaction || '';
        document.getElementById('install-time').innerHTML = data.install?.time || '';

        document.getElementById('assessment-procedure').innerHTML = data.assessment?.procedure || '';
        document.getElementById('assessment-interaction').innerHTML = data.assessment?.interaction || '';
        document.getElementById('assessment-time').innerHTML = data.assessment?.time || '';

        document.getElementById('activity-summary').innerHTML = data.activitySummary || '';
        document.documentElement.className = data.theme || 'theme-doodle';
        document.getElementById('theme-selector').value = (data.theme || 'theme-doodle').replace('theme-', '');
    }

    async function loadPlan(planId) {
        if (!currentUser) return;
        showLoading();
        try {
            const planRef = doc(db, "users", currentUser.uid, "lessonPlans", planId);
            const planDoc = await getDoc(planRef);
            if (planDoc.exists()) {
                const planData = planDoc.data();
                currentPlanId = planId;
                isEditMode = true;
                populateForm(planData);
                showToast("Lesson plan loaded successfully!", "success");
            } else {
                showToast("Lesson plan not found.", "error");
            }
        } catch (error) {
            console.error("Error loading plan:", error);
            showToast("Could not load the lesson plan.", "error");
        } finally {
            hideLoading();
        }
    }

    async function savePlan(planName) {
      if (!currentUser || !planName.trim()) return;
      showLoading();
      try {
        const planData = collectPlanData();
        planData.planName = planName.trim();
        planData.updatedAt = serverTimestamp();
        
        let docRef;
        if (isEditMode && currentPlanId) {
            docRef = doc(db, "users", currentUser.uid, "lessonPlans", currentPlanId);
            await updateDoc(docRef, planData);
            showToast("Lesson plan updated successfully!", "success");
        } else {
            planData.createdAt = serverTimestamp();
            const plansRef = collection(db, "users", currentUser.uid, "lessonPlans");
            const newDoc = await addDoc(plansRef, planData);
            currentPlanId = newDoc.id;
            isEditMode = true;
            showToast("Lesson plan saved successfully!", "success");
        }
        
        saveModal.style.display = 'none';
        planNameInput.value = '';

      } catch (error) {
        console.error("Error saving plan:", error);
        showToast("Error saving plan. Please try again.", "error");
      } finally {
        hideLoading();
      }
    }

    // --- EVENT LISTENERS ---
    saveButton.addEventListener('click', () => {
      saveModal.style.display = 'flex';
      planNameInput.focus();
    });

    closeModalBtn.addEventListener('click', () => {
      saveModal.style.display = 'none';
      planNameInput.value = '';
    });

    confirmSaveBtn.addEventListener('click', () => {
      const planName = planNameInput.value.trim();
      if (planName) {
        savePlan(planName);
      } else {
        showToast("Please enter a name for your plan.", "error");
      }
    });

    window.addEventListener('click', (e) => {
      if (e.target === saveModal) {
        saveModal.style.display = 'none';
        planNameInput.value = '';
      }
    });
    
    // --- RICH TEXT EDITOR LOGIC (simplified) ---
    let activeEditor = null;
    document.addEventListener('focusin', e => {
        if (e.target.isContentEditable) activeEditor = e.target;
    });

    function exec(cmd, value = null) {
      if (activeEditor) document.execCommand(cmd, false, value);
    }
    
    document.querySelectorAll('[data-cmd]').forEach(btn => {
        btn.addEventListener('click', e => {
            e.preventDefault();
            exec(btn.dataset.cmd);
        });
    });
    // Add other rich text editor functions here...


    // --- CURRICULUM & PAGE LOGIC ---
    const themeSelector = document.getElementById('theme-selector');
    themeSelector.addEventListener('change', (e) => {
      document.documentElement.className = `theme-${e.target.value}`;
    });
    const curriculumData = { "3PS": { "Sequence 01: Family and Friends": { "Section 01: Family": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and write", "SESSION 04: I play roles"], "Section 02: Friends": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and write", "SESSION 04: I play roles"] }, "Sequence 02: School": { "Section 01: School Objects": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and write", "SESSION 04: I play roles"], "Section 02: School Subjects": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and write", "SESSION 04: I play roles"] }, "Sequence 03: Home": { "Section 01: Describing a House": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and write", "SESSION 04: I play roles"], "Section 02: Location Rooms in a House": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and write", "SESSION 04: I play roles"] }, "Sequence 04: Play Time": { "Section 01: Toys": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and write", "SESSION 04: I play roles"], "Section 02: Favourite Toys": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and write", "SESSION 04: I play roles"] }, "Sequence 05: Pets": { "Section 01: Pets": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and write", "SESSION 04: I play roles"], "Section 02: Pets Body Parts": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and write", "SESSION 04: I play roles"] }, "Sequence 06: Birthday": { "Section 01: Party Invitation": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and write", "SESSION 04: I play roles"], "Section 02: Party Celebration": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and write", "SESSION 04: I play roles"] } }, "4PS": { "Sequence 01: Family and Friends": { "Section 01: Family": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and enjoy", "SESSION 04: I read and write", "SESSION 05: I play roles"], "Section 02: Friends": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and enjoy", "SESSION 04: I read and write", "SESSION 05: I play roles"] }, "Sequence 02: School": { "Section 01: School Facilities": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and enjoy", "SESSION 04: I read and write", "SESSION 05: I play roles"], "Section 02: Mapping": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and enjoy", "SESSION 04: I read and write", "SESSION 05: I play roles"] }, "Sequence 03: Fun Time and Games": { "Section 01: Fun Time": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and enjoy", "SESSION 04: I read and write", "SESSION 05: I play roles"], "Section 02: Games": ["SESSION 01: I sing and have fun, I listen and repeat", "SESSION 02: I read and discover", "SESSION 03: I read and enjoy", "SESSION 04: I read and write", "SESSION 05: I play roles"] } }, "5PS": { "Sequence 01: Jobs, Occupations, and Hobbies": { "Section 01: Jobs and Occupations": ["SESSION 01: I get ready.", "SESSION 02: I listen and interact", "SESSION 03: I listen and discover", "SESSION 04: I read and understand", "SESSION 05: I read and discover", "SESSION 06: I learn and enjoy", "SESSION 07: I learn and write", "SESSION 08: I write"], "Section 02: Hobbies": ["SESSION 01: I listen and interact", "SESSION 02: I listen and discover", "SESSION 03: I read and understand", "SESSION 04: I read and discover", "SESSION 05: I learn and enjoy", "SESSION 06: I learn to write", "SESSION 07: I write", "SESSION 08: I check my progress"] }, "Sequence 02: Hometown, City, Village Amenities": { "Section 01: Hometown, City, Village Amenities": ["SESSION 01: I get ready.", "SESSION 02: I listen and interact", "SESSION 03: I listen and discover", "SESSION 04: I read and understand", "SESSION 05: I read and discover", "SESSION 06: I learn and enjoy", "SESSION 07: I learn and write", "SESSION 08: I write"], "Section 02: Directions": ["SESSION 01: I listen and interact", "SESSION 02: I listen and discover", "SESSION 03: I read and understand", "SESSION 04: I read and discover", "SESSION 05: I learn and enjoy", "SESSION 06: I learn to write", "SESSION 07: I write", "SESSION 08: I check my progress"] }, "Sequence 03: Holidays and Travelling": { "Section 01: Holidays": ["SESSION 01: I get ready.", "SESSION 02: I listen and interact", "SESSION 03: I listen and discover", "SESSION 04: I read and understand", "SESSION 05: I read and discover", "SESSION 06: I learn and enjoy", "SESSION 07: I learn and write", "SESSION 08: I write"], "Section 02: Travelling": ["SESSION 01: I listen and interact", "SESSION 02: I listen and discover", "SESSION 03: I read and understand", "SESSION 04: I read and discover", "SESSION 05: I learn and enjoy", "SESSION 06: I learn to write", "SESSION 07: I write", "SESSION 08: I check my progress"] } } };
    const levelSelect = document.getElementById("levelSelect");
    const sequenceSelect = document.getElementById("sequenceSelect");
    const sectionSelect = document.getElementById("sectionSelect");
    const sessionSelect = document.getElementById("sessionSelect");
    const specialOption = "REMEDIATION & STANDARDISATION";
    function resetSelect(selectElement, placeholderText) { selectElement.innerHTML = `<option value="">${placeholderText}</option>`; }
    function initializeLevels() { resetSelect(levelSelect, "Select Level"); Object.keys(curriculumData).forEach(level => levelSelect.add(new Option(level, level))); }
    levelSelect.addEventListener("change", () => {
        const selectedLevel = levelSelect.value;
        resetSelect(sequenceSelect, "Select Sequence"); resetSelect(sectionSelect, "Select Section"); resetSelect(sessionSelect, "Select Session");
        if (!selectedLevel) return;
        Object.keys(curriculumData[selectedLevel]).forEach(seq => sequenceSelect.add(new Option(seq, seq)));
        sequenceSelect.add(new Option(specialOption, specialOption));
    });
    sequenceSelect.addEventListener("change", () => {
        const selectedLevel = levelSelect.value; const selectedSeq = sequenceSelect.value;
        resetSelect(sectionSelect, "Select Section"); resetSelect(sessionSelect, "Select Session");
        if (!selectedSeq) return;
        if (selectedSeq === specialOption) { sectionSelect.innerHTML = `<option value="${specialOption}">${specialOption}</option>`; sessionSelect.innerHTML = `<option value="${specialOption}">${specialOption}</option>`; return; }
        Object.keys(curriculumData[selectedLevel][selectedSeq]).forEach(sec => sectionSelect.add(new Option(sec, sec)));
    });
    sectionSelect.addEventListener("change", () => {
        const selectedLevel = levelSelect.value; const selectedSeq = sequenceSelect.value; const selectedSec = sectionSelect.value;
        resetSelect(sessionSelect, "Select Session");
        if (!selectedSec || selectedSec === specialOption) return;
        curriculumData[selectedLevel][selectedSeq][selectedSec].forEach(session => sessionSelect.add(new Option(session, session)));
    });
    initializeLevels();
  </script>
</body>
</html>
